# mediapipe-fitness-tracker
mediapipe运动计数系统
# 基于Mediapipe的自动体测计数器

##  1. 设计背景

如今各个年龄段都在提倡锻炼，从小学到大学各个学校都有体测的要求，需要记录锻炼的指标，以及各位健身爱好者也将锻炼相关的指标作为自己的打卡目标。在体测的背景下多为相关老师教练进行人工计数，或者不同的项目有不同的测量仪器。也有人使用手环等电子设备内置的惯性传感器进行运动监测计数，但是可能并不太准。

随着计算机视觉以及人工智能相关技术的发展，视觉方法在人常生活乃至生活得到了越来越广泛地应用，我们组希望可以通过视觉识别的方法更直接也能更准确地检测运动状况，来协助锻炼者记录多种特定运动姿态的动作个数。

效果演示：

![](https://sciencebook.oss-cn-hangzhou.aliyuncs.com/202303122214461.gif)

## 2. 系统方案设计

### 2.1 系统总体设计介绍

![](https://sciencebook.oss-cn-hangzhou.aliyuncs.com/202302202240115.jpg)

图1 体测计数器界面图

本项目可以通过选框选择是否读取视频文件，并且通过按键选择进行四种动作的识别，在计数过程中可以及时单击停止按键进行打断，在视频中显示此时的运动状态以及个数。

### 2.2人体姿态估计简介

人体姿态估计(Human Pose Estimation)是计算机视觉中一个很基础的问题，也是许多高层语义任务和下游应用场景的基础。顾名思义，可以理解为对“人体”的姿态（关键点，比如头，左手，右脚等）的位置估计。从图像或视频中估计人体姿态在健康跟踪、手语识别和手势控制等各种应用中起着核心作用。 

### 2.3BlazePose

BlazePose，是谷歌mediapipe库中一种轻量级[卷积神经网络](https://so.csdn.net/so/search?q=卷积神经网络&spm=1001.2101.3001.7020)架构，用于人体姿态估计，可用于移动设备上的实时推断。网络为一个人产生33个身体关键点，特别适合姿态跟踪和手语识别等实时用例。我们的主要贡献包括一个新的身体姿态跟踪解决方案和一个轻量级的身体姿态估计神经网络，使用热图和回归到关键点坐标。

### 2.4检测思路

先使用一个快速和轻量级的人脸检测器，找到人体的位置。再寻找关键点。 在人体上使用33个点，如图3所示。 

![image-20230220224557790](https://sciencebook.oss-cn-hangzhou.aliyuncs.com/202302202245865.png)

图2  检测33个标点

![image-20230220224606305](https://sciencebook.oss-cn-hangzhou.aliyuncs.com/202302202246402.png) 

图3   检测33个标点

​	

### 2.5遮挡增强

​    为了支持不可见点的预测，mediapipe还有遮挡预测功能，即使是在严重遮挡的情况下，如只上半身或当人的大部分身体不在场景中也能检测到骨架的大致位置。

## 3识别算法设计

### 3.1算法原理

调用mediapipe，获得关键点的位置。设计判断运动状态的的计算角度，设置阈值，判断运动状态。当运动状态改变时实现运动计数，次数加一，并显示到窗口上。

### 3.2.定义角度：BodyPartAngle

| 角度名称               | 夹角选用的坐标点         |
| ---------------------- | ------------------------ |
| angle_of_the_left_arm  | 左肩-左肘-左腕           |
| angle_of_the_right_arm | 右肩-右肘-右腕           |
| angle_of_the_left_leg  | 左髋-左膝-左踝           |
| angle_of_the_right_leg | 右髋-右膝-右踝           |
| angle_of_the_neck      | 左右肩膀-口-臀部平均点   |
| angle_of_the_abdomen   | 左右肩膀-臀部-膝盖平均点 |

### 3.3定义运动状态阈值：

 

| 运动类型 | 判断标准                       | True state                 | False state               |
| -------- | ------------------------------ | -------------------------- | ------------------------- |
| push_up  | 左右手臂角平均值               | avg_arm_angle> 160         | avg_arm_angle < 70        |
| pull_up  | 鼻子的平均高度与肩膀的平均高度 | nose[1]<avg_shoulder_y     | nose[1]>avg_shoulder_y    |
| squat    | 左右腿角平均值                 | avg_leg_angle > 160        | avg_leg_angle < 70        |
| sit_up   | 腿与膝盖、上身夹角的平均值     | angle_of_the_abdomen > 105 | angle_of_the_abdomen < 55 |

 

### 3.4显示信息：score_table(exercise, frame, counter, status): 

运动类型、计数器、运动状态

## 4. GUI界面设计

整体GUI设计采用PyQT5进行开发。

## 5.系统调试运行结果说明及分析

平台：Jeston Nano

语言：Python

软件：PyQT5、Mediapipe

最终打开识别视频文件的效果（以仰卧起坐为例）：

![](https://sciencebook.oss-cn-hangzhou.aliyuncs.com/202302212122053.gif)


 



 
